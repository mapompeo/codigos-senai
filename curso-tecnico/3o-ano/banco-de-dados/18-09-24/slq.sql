DROP SCHEMA IF EXISTS BIBLIOTECA;
CREATE SCHEMA BIBLIOTECA;
USE BIBLIOTECA;

CREATE TABLE USUARIO (
    CODUSUARIO NUMERIC(5) NOT NULL PRIMARY KEY,
    LOGIN VARCHAR(50) NOT NULL,
    SENHA VARCHAR(20) NOT NULL,
    PERFIL NUMERIC(1) NOT NULL
);
-- SELECT * FROM USUARIO;

CREATE TABLE ESTUDANTE (
    MATRICULA NUMERIC(5) NOT NULL PRIMARY KEY,
    NOMECOMPLETO VARCHAR(100) NOT NULL,
    DATANASCIMENTO DATE NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    TELEFONE NUMERIC(11) NOT NULL
);
-- SELECT * FROM ESTUDANTE;

ALTER TABLE ESTUDANTE 
ADD FOREIGN KEY (MATRICULA) REFERENCES USUARIO (CODUSUARIO);

CREATE TABLE LIVRO (
    CODLIVRO NUMERIC(5) NOT NULL PRIMARY KEY,
    TITULO VARCHAR(100) NOT NULL,
    AUTOR VARCHAR(100) NOT NULL,
    ANO NUMERIC(4) NOT NULL,
    EDITORA VARCHAR(50) NOT NULL
);

CREATE TABLE EMPRESTIMO (
    CODEMPRESTIMO NUMERIC(5) NOT NULL PRIMARY KEY,
    DATAENTRADA DATE NOT NULL,
    DATARETIRADA DATE NOT NULL,
    DEVOLUCAO VARCHAR(2),
    MATRICULA NUMERIC(5) NOT NULL,
    CODLIVRO NUMERIC(5) NOT NULL
);

ALTER TABLE EMPRESTIMO 
ADD FOREIGN KEY (MATRICULA) REFERENCES ESTUDANTE (MATRICULA);

ALTER TABLE EMPRESTIMO 
ADD FOREIGN KEY (CODLIVRO) REFERENCES LIVRO (CODLIVRO);

-- SELECT * FROM EMPRESTIMO;

INSERT INTO USUARIO (CODUSUARIO, LOGIN, SENHA, PERFIL) VALUES
(1, 'joao.silva', 'qwe123@', 2),
(2, 'maria.martins', 'qwe123@', 2),
(3, 'alice.pires', 'qwe123@', 2),
(4, 'andre.souza', 'qwe123@', 2),
(5, 'renato.alencar', 'qwe123@', 2),
(6, 'bruna.garcia', 'asd123#', 1);

INSERT INTO ESTUDANTE (MATRICULA, NOMECOMPLETO, DATANASCIMENTO, EMAIL, TELEFONE) VALUES
(1, 'João Silva', '2009-01-01', 'joao@gmail.com', 4795959595),
(2, 'Maria Martins', '2009-10-20', 'maria@gmail.com', 4796969696),
(3, 'Alice Pires', '2009-11-26', 'alice@gmail.com', 4797979797),
(4, 'André Souza', '2009-03-25', 'andre@gmail.com', 4798989898),
(5, 'Renato Alencar', '2009-01-23', 'renato@gmail.com', 4799999999);

INSERT INTO LIVRO (CODLIVRO, TITULO, AUTOR, ANO, EDITORA) VALUES
(1, 'Harry Potter e a Pedra Filosofal', 'J. K. Rowling', 1997, 'Rocco'),
(2, 'O Pequeno Príncipe', 'Antoine de Saint-Exupéry', 2015, 'LaFonte'),
(3, 'Pollyana', 'Eleanor H. Porter', 2016, 'Autêntica Infantil e Juvenil'),
(4, 'Diário de um Banana', 'Jeff Kinney', 2007, 'VR Editora'),
(5, 'Coraline', 'Neil Gaiman', 2002, 'Intrínseca');

INSERT INTO EMPRESTIMO (CODEMPRESTIMO, DATAENTRADA, DATARETIRADA, DEVOLUCAO, MATRICULA, CODLIVRO) VALUES
(1, '2021-10-13', '2021-10-20', NULL, 1, 1),
(2, '2021-10-25', '2021-11-01', NULL, 2, 2),
(3, '2021-10-04', '2021-10-11', 'OK', 3, 2),
(4, '2021-09-20', '2021-09-27', 'OK', 4, 3),
(5, '2021-09-01', '2021-09-08', 'OK', 5, 4);