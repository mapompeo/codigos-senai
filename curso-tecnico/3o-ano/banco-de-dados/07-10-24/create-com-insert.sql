DROP SCHEMA IF EXISTS BIBLIOTECA;
CREATE DATABASE IF NOT EXISTS BIBLIOTECA;
USE BIBLIOTECA;

CREATE TABLE USUARIO (
    CODUSUARIO NUMERIC(5) NOT NULL PRIMARY KEY,
    LOGIN VARCHAR(50) NOT NULL,
    SENHA VARCHAR(20) NOT NULL,
    PERFIL NUMERIC(1) NOT NULL
);

CREATE TABLE ESTUDANTE (
    MATRICULA NUMERIC(5) NOT NULL PRIMARY KEY,
    NOMECOMPLETO VARCHAR(100) NOT NULL,
    DATANASCIMENTO DATE NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    TELEFONE NUMERIC(11) NOT NULL
);

ALTER TABLE ESTUDANTE 
ADD FOREIGN KEY (MATRICULA) 
REFERENCES USUARIO (CODUSUARIO);

CREATE TABLE LIVRO (
    CODLIVRO NUMERIC(5) NOT NULL PRIMARY KEY,
    TITULO VARCHAR(100) NOT NULL,
    AUTOR VARCHAR(100) NOT NULL,
    ANO NUMERIC(4) NOT NULL,
    EDITORA VARCHAR(50) NOT NULL
);

CREATE TABLE EMPRESTIMO (
    CODEMPRESTIMO NUMERIC(5) NOT NULL PRIMARY KEY,
    DATAENTRADA DATE NOT NULL,
    DATARETIRADA DATE NOT NULL,
    DEVOLUCAO VARCHAR(2),
    MATRICULA NUMERIC(5) NOT NULL,
    CODLIVRO NUMERIC(5) NOT NULL
);

ALTER TABLE EMPRESTIMO 
ADD FOREIGN KEY (MATRICULA) 
REFERENCES ESTUDANTE (MATRICULA);

ALTER TABLE EMPRESTIMO 
ADD FOREIGN KEY (CODLIVRO) 
REFERENCES LIVRO (CODLIVRO);

-- INSERTS

INSERT INTO USUARIO (CODUSUARIO, LOGIN, SENHA, PERFIL) VALUES
(1, 'JOAO.SILVA', 'QWE123@', 2),
(2, 'MARIA.MARTINS', 'QWE123@', 2),
(3, 'ALICE.PIRES', 'QWE123@', 2),
(4, 'ANDRE.SOUZA', 'QWE123@', 2),
(5, 'RENATO.ALENCAR', 'QWE123@', 2),
(6, 'BRUNA.GARCIA', 'ASD123#', 1);

INSERT INTO ESTUDANTE (MATRICULA, NOMECOMPLETO, DATANASCIMENTO, EMAIL, TELEFONE) VALUES
(1, 'JOÃO SILVA', '2009-01-01', 'JOAO@GMAIL.COM', 4795959595),
(2, 'MARIA MARTINS', '2009-10-20', 'MARIA@GMAIL.COM', 4796969696),
(3, 'ALICE PIRES', '2009-11-26', 'ALICE@GMAIL.COM', 4797979797),
(4, 'ANDRÉ SOUZA', '2009-03-25', 'ANDRE@GMAIL.COM', 4798989898),
(5, 'RENATO ALENCAR', '2009-01-23', 'RENATO@GMAIL.COM', 4799999999);

INSERT INTO LIVRO (CODLIVRO, TITULO, AUTOR, ANO, EDITORA) VALUES
(1, 'HARRY POTTER E A PEDRA FILOSOFAL', 'J. K. ROWLING', 1997, 'ROCCO'),
(2, 'O PEQUENO PRÍNCIPE', 'ANTOINE DE SAINT-EXUPÉRY', 2015, 'LAFONTE'),
(3, 'POLLYANA', 'ELEANOR H. PORTER', 2016, 'AUTÊNTICA INFANTIL E JUVENIL'),
(4, 'DIÁRIO DE UM BANANA', 'JEFF KINNEY', 2007, 'VR EDITORA'),
(5, 'CORALINE', 'NEIL GAIMAN', 2002, 'INTRÍNSECA');

INSERT INTO EMPRESTIMO (CODEMPRESTIMO, DATAENTRADA, DATARETIRADA, DEVOLUCAO, MATRICULA, CODLIVRO) VALUES
(1, '2021-10-13', '2021-10-20', NULL, 1, 1),
(2, '2021-10-25', '2021-11-01', NULL, 2, 2),
(3, '2021-10-04', '2021-10-11', 'OK', 3, 2),
(4, '2021-09-20', '2021-09-27', 'OK', 4, 3),
(5, '2021-09-01', '2021-09-08', 'OK', 5, 4);